---
title: "Cooperation between arbuscular mycorrhizal fungi and plant growth-promoting bacteria and their effects on plant growth and soil quality"
authors Group A : "Keve Toth ; Jakov Cancar ; Camille Delabaere"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide                  # Fold the code
    self_contained: TRUE
    
---

 [Cooperation between arbuscular mycorrhizal fungi and plant growth-promoting bacteria and their effects on plant growth and soil quality](https://peerj.com/articles/13080/)

## Preamble :

This is the final project for the subject "Data Acquisition Analysis and Scientific Methods for Life Sciences" shorted as "Data" from the first course of the Master Plant Health at the Universitat Politècnica de València.

## <u>Guidelines</u> :

In this project the students chose a scientific article and redo all possible statistic analyses and graphics from it, trying different approaches to see if they can improve them. They will use the data included in the article and follow the Material and methods chapter as a guide.

### Introduction. Why your project is interesting? & What is known already about it?

We chose this scientific paper because we were interested in the knowledge we could gain about the relationship between plants & microorganisms *(here arbuscular mycorrhizal fungi (AMF) & plant growth-promoting bacteria (PGPB))*. A way to understand how the growth of plants & physico chemical properties of the soil are influenced by different treatments. Finaly, as "Almost 25% of the Earth’s biodiversity is composed of soil microorganisms (...)" (Fierer, 2017; Wagg et al., 2019; Whitman, Coleman & Wiebe, 1998), we thought we would acquire knowledge that we can later on, apply during our career.

### What we know already

**AMF** - present to 70% of the terrestrial plants *"Arbuscular mycorrhizal fungi (AMF), (...) maintain symbiotic relationships with over 70% of terrestrial plants and provide nutrients and water to plants in exchange for sugars through their arbuscules (...)"* (Schussler, Schwarzott & Walker, 2001; Wagg et al., 2019) and favorise the exchange of nutrients/sugars thanks to arbuscules. It enhances resilience of plants for drought, heavy metals & pathogens.

**PGPR** - include B (Bacillus spp…), contribute to the fixation of N, solubilisation of P, production of phytohormones & systemic resistance. *Bacillus spp. promotes plant growth by fixing N, solubilizing and mineralizing P and other nutrients, stimulating phytohormones, producing siderophores, inducing systemic resistance (ISR), and enhancing their tolerance to abiotic stresses* (Bonfante & Genre, 2010; Saxena et al., 2020). AMF & PGPR provide ecological solutions to improve health soil & plants productivity.

### Objectives and hypotheses

The <u>objectives</u> are to analyse if arbuscular mycorrhizal fungi\* AMF\* & plant growth-promoting rhizobacteria *PGRB* have any synergy effects on nutrients uptakes or plant growth to a more effective extent than for each microorganism studied alone.

The <u>hypotheses</u> are 1) AMF and PGPR could mutually symbiose and enhance the plant growth of Elymus nutans Griseb, & (2) the co-existence of AMF and PGPR could improve plant traits and soil quality better than their individual applications.

### *Methods*

### Origin & structure of the data

It comes from the scientific article [Cooperation between arbuscular mycorrhizal fungi and plant growth-promoting bacteria and their effects on plant growth and soil quality](https://peerj.com/articles/13080/) by Yu L, Zhang H, Zhang W, Liu K, Liu M, Shao X. 2022.

```{r,include=FALSE, results="hide"}

# Load required libraries
library(here)

# Dynamically set the path to the script
script_path <- here("R", "00_GetData.R")

# Source the script
source(script_path)

# Print a sample data object to confirm
print(plant_soil)
```

```{r display_tbl_kable, echo=TRUE}
library(knitr)
kable(plant_soil, caption = "<span style='color: red; text-decoration: underline; font-style: italic; font-size: 20px;'>plant_soil</span>")


```

*Details - CK1 : Control, A2 : Inocculation with AMF only, B3 : Incculation with Bacillus only, AB5 : Incculation with Bacillus & AMF*

### Analyitical Methods used

Correlation analyses, ANOVA analyse, and some multivariate analyses were realized :

-   <u>ANOVA</u> (Analysis of Variance)

ANOVA (Analysis of Variance) is used to compare the means of multiple variances to determine if there are statistically significant differences between them. Here to compare the effects of AMF or PGPB treatment only, or combination of both treatments or none of them on soil content and plant growth. Also a way to analyze the impact of independent variables on a dependent variable & to test interactions between factors. Finaly done in order to reliably and efficiently compare the means of multiple groups while controlling for statistical errors.

-   <u>PCA</u> (Principal Component Analysis)

PCA is a statistical technique used for dimensional reduction and data simplification. Transforming high-dimensional data into a smaller number of uncorrelated variables called *principal components*. These components capture the most important features of the original data.

**NB**: By keeping only the most important components, PCA simplifies the data without losing much information, which is particularly useful for tasks like pattern recognition, data visualization, and improving the performance of machine learning models.

-   <u>LDA</u> (Linear Discriminant Analysis) It works by finding a linear combination of features that best separates multiple classes.

**NB**: Unlike PCA (*unsupervising and focusing on maximizing variance*) LDA aims to maximize the separation between different classes.

We plan to start with each variable analyses separately then ANOVA analyses we'll combine these small results analyses with the knowledge acquire from the article chosen to define the larger scale multivariate analyses. These might be a relationship between soil nutrients/quality and plant size measurements (multiple roots measurements and above ground biomass). 

<br> <br>

# Results

<br> <br>

# <u>P values for each variable obtained by ANOVA analyisis, as well as Bonferroni corrected P values</u>

```{r,error=FALSE, warning=FALSE, message=FALSE, echo=TRUE}
library(DT)

# Filter numeric variables for ANOVA
response_vars <- colnames(plant_soil)[sapply(plant_soil, is.numeric) & colnames(plant_soil) != "Group"]
# Initialize a dataframe to store ANOVA results
anova_results <- data.frame(Variable = character(), P_Value = numeric(), stringsAsFactors = FALSE)

# Perform ANOVA for each numeric variable
for (var in response_vars) {
  formula <- as.formula(paste("`", var, "` ~ Group", sep = ""))
  anova_result <- aov(formula, data = plant_soil)
  anova_summary <- summary(anova_result)
  
  # Extract p-value
  p_value <- anova_summary[[1]]$`Pr(>F)`[1]
  anova_results <- rbind(anova_results, data.frame(Variable = var, P_Value = p_value))
}

# Apply Bonferroni correction
anova_results$Bonferroni_P <- p.adjust(anova_results$P_Value, method = "bonferroni")

# Save ANOVA results to a CSV file
write.csv(anova_results, "ANOVA_Results.csv", row.names = FALSE)

library(knitr)

# Display the results as a simple table
kable(anova_results, caption = "ANOVA Results with Bonferroni Correction")

```

<br> <br>

# <u>Showcasing all significant ANOVA analyses in boxplots</u>

Here we compiled all boxplots based on our anova analysis. CK1 = Control, A2 = AMF treatment  B3 = PGPB, and AB5 = Both PGPB and AMF treatments together. 

It is interesting to note that not all variables measured showcased a significant difference between treatment groups so these we did not make box plots of. During our analysis we noticed that AMF treatment and AMF + PGPB treatments usually showed similar results in variation and they always differed from the control and only PGPB treatments which also usually clustered together. This means that AMF treatment had a much greater impact on plant and soil variables measured than than PGPB treatment. And mos of the variation and results of the two treatment together can be explained by only the AMF treatment. 

```{r, error=FALSE, echo=TRUE, warning=FALSE, message=FALSE, fig.width=12, fig.height=12}
# Load necessary libraries
library(ggplot2)
library(dplyr)
library(gridExtra)

# Assume `plant_soil` is your dataframe
# Rename the grouping column for convenience (if not already done)
colnames(plant_soil)[1] <- "Group"

# Reorder the factor levels of the "Group" column
desired_order <- c("CK1", "B3", "A2", "AB5")
plant_soil$Group <- factor(plant_soil$Group, levels = desired_order)

# Get the names of all response variables (excluding the grouping column)
response_vars <- colnames(plant_soil)[2:ncol(plant_soil)]  # Adjust as needed

# Initialize an empty list to store plots
plot_list <- list()

# Iterate over each response variable to perform ANOVA and plot
for (var in response_vars) {
  # Perform ANOVA
  formula <- as.formula(paste("`", var, "` ~ Group", sep = ""))
  anova_result <- aov(formula, data = plant_soil)
  anova_summary <- summary(anova_result)
  
  # Extract p-value
  p_value <- anova_summary[[1]]$`Pr(>F)`[1]
  
  # Only generate plots for significant results
  if (p_value < 0.05) {
    # Visualization using ggplot2
    p <- ggplot(plant_soil, aes_string(x = "Group", y = paste0("`", var, "`"), fill = "Group")) +
      geom_boxplot() +
      theme_minimal() +
      labs(title = paste("Boxplot of", var, "Across Groups"),
           x = "Group",
           y = var) +
      # Dynamically set the y-position for the p-value annotation
      annotate("text", x = 1.5, y = min(plant_soil[[var]], na.rm = TRUE) - 0.5, 
               label = paste("p =", signif(p_value, digits = 3)), 
               hjust = 0, vjust = 1, size = 3, color = "red") +  # Moved p-value lower
      theme(plot.title = element_text(size = 7),  # Smaller title size
            axis.title = element_text(size = 7),   # Axis title size (optional)
            axis.text = element_text(size = 5))    # Axis labels size (optional)
    
    # Append the plot to the plot list
    plot_list <- c(plot_list, list(p))
  }
}

# Combine all the plots into a grid
if (length(plot_list) > 0) {
  do.call(grid.arrange, c(plot_list, ncol = 4))  # Adjust ncol for layout
}
 
```

<br> <br>

# <u>Showcasing all ANOVA analysis with significant difference between AMF treatment and AMF + PGPB treatments</u>

To further analyse weather the PGPB had any synergistic effects with AMF we created ANOVA analysis box plots that showcase only AMF and PGPB + AMF treatments only if there is a significant difference between the two treatments not considering other treatments. 

We can see that there is a synergistic effect because the treatment AMF + PGPB resulted in a significantly larger biomass, it also resulted in a significantly larger plant phosphorus content. Which is even more interesting since this means that the PGPB increased the Phosphorus uptake of AMF since normally AMF is attributed with the capability of up taking the non mobile nutrient. 

We can also see that there is some significant difference between treatments in the soil parameters which is interesting since it might let us understand that with the PGPB present AMF have a different chemical metabolism an secrete different metabolites into the soil. Which shows that there is a clear interaction between PGPB and AMF. 
```{r, error=FALSE, echo=TRUE, fig.width=12, fig.height=12}

library(gridExtra)

# List to store plots
plots <- list()

# Filter the dataframe
filtered_data <- plant_soil %>% filter(Group %in% c("A2", "AB5"))


# Iterate over response variables
for (var in response_vars) {
  # Perform ANOVA
  formula <- as.formula(paste("`", var, "` ~ Group", sep = ""))
  anova_result <- aov(formula, data = filtered_data)
  anova_summary <- summary(anova_result)
  
  # Extract p-value
  p_value <- anova_summary[[1]]$`Pr(>F)`[1]
  
  # Check if p-value is less than 0.05
  if (p_value < 0.05) {
    # Calculate dynamic y-axis limits
    y_min <- min(filtered_data[[var]], na.rm = TRUE)
    y_max <- max(filtered_data[[var]], na.rm = TRUE)
    y_buffer <- (y_max - y_min) * 0.1  # Add 10% buffer for annotation space
    adjusted_y_max <- y_max + y_buffer
    
    # Create the boxplot
   p <- ggplot(filtered_data, aes_string(x = "Group", y = paste0("`", var, "`"), fill = "Group")) +
      geom_boxplot() +
      theme_minimal() +
      labs(title = paste("ANOVA boxplot of", var, "for A2 and AB5"),
           x = "Group",
           y = var) +
      coord_cartesian(ylim = c(y_min, adjusted_y_max)) +
            annotate("text", 
               x = 1.5, 
               y = adjusted_y_max - (y_buffer ),  # Moves the text lower
               label = paste("p =", signif(p_value, digits = 3)), 
               hjust = 0, 
               vjust = -0.5, 
               size = 5, 
               color = "red")+
     
      theme(plot.title = element_text(size = 10))
    
    # Save plot to list
    plots[[length(plots) + 1]] <- p
  }
}

# Arrange plots in a 2-column layout
do.call(grid.arrange, c(plots, ncol = 2))






```

*Details - NO3-N : Nitrate , UE : Soil urease enzyme , EC : Electrical conductivity , Plant P : Plant phosphorus* 
<br> <br>

# <u>Principle Component Analysis (PCA) of plants measured variables and soil measured variables separately</u>

For the principle components analyisis we decide to separate the measured variables, as there was too many to result in a PCA that is informative at all. So we decide to separate the variables into two groups one group being the 
Plant Parameters which contained: Aboveground_Biomass, Belowground_Biomass, Total_Biomass, RootLength, RootSurfaceArea, RootAverageDiameter, Rvolume, Rootbranches, SIZE, R/S_ratio, HEIGHT, Plant_P, Plant_N, Plant_C, Specific Root Length.

And soil parameters containing: NH4+-N, NO3-N, Total_N, Total_C, Available_P, Total_P, ALP, UE, EC, PH.

We then conducted a principle components analysis on both groups of variables separately. 

For the plant parameters PC1 is pretty good at separating the treatment groups as it accounts for 73.2% of variation. Resulting in clear groupings in the PCA plot. Meaning that there are multiple variables in Plant parameters with very large variations that correspond with groups as well. The most important variables for PC1 are Below ground biomass, Root branches, Plant P, and Stem diameter. Plant phosphorus content is not surprising at all since it probably helps differentiate between the AMF and the PGPB + AMF treatment groups. 

For the soil parameters PC1 only explains 42.9% of variance however PC2 explains 27.1% of variance so together explaining 70% of variance. The most important components of PC1 and PC2 of the soil parameters were Soil Urease concentration, soil NO3-N, and EC. All of these point the fact that the metabolism of the plants with and without AMF and PGPB wildly differed. This means that there are not very large variation between Soil paramter variables. 

However we could differentiate between treatment groups much better based on plant parameters compared to soil parameters, this is probably because only a few soil parameters had a large variation. Whereas there was a big variation in multiple plant parameters making it easier to differentiate between treatment groups. 
```{r, error=FALSE, include=FALSE}
# 07_Subsetting soil-plant parameters.R
# Subset 1: Plant parameters (including 'Group' as the treatment column)
Plant_param <- plant_soil[,c("Group","Aboveground_Biomass","Belowground_Biomass"
                             ,"Total_Biomass","RootLength", "RootSurfaceArea",
                             "RootAverageDiameter", "Rvolume","Rootbranches",
                             "SIZE","R/S_ratio", "HEIGHT","Plant_P", "Plant_N", 
                             "Plant_C", "SRL")]



# Subset 2: Soil parameters (including 'Group' as the treatment column)
Soil_param <- plant_soil[, c("Group", "NH4+-N", "NO3-N", "Total_N", "Total_C", 
                             "Available_P", "Total_P", "ALP", "UE", "EC", "PH")]



```

```{r, error=FALSE, echo=TRUE, fig.width=12, fig.height=12}
# 08_PCAsubsetted.R
# Load necessary libraries
if (!require(ggplot2)) install.packages("ggplot2")
if (!require(factoextra)) install.packages("factoextra")

library(ggplot2)
library(factoextra)

# Normalize function: divide each column by its standard deviation
normalize <- function(df) {
  numeric_cols <- sapply(df, is.numeric)  # Identify numeric columns
  df[, numeric_cols] <- scale(df[, numeric_cols], center = FALSE, scale = TRUE)  # Divide by SD
  return(df)
}

# Normalize subsets (excluding 'Group' column)
Plant_param_normalized <- normalize(Plant_param[ , -1])  # Exclude 'Group' for normalization
Soil_param_normalized <- normalize(Soil_param[ , -1])    # Exclude 'Group' for normalization

# Add the 'Group' column back
Plant_param_normalized$Group <- Plant_param$Group
Soil_param_normalized$Group <- Soil_param$Group

# Perform PCA for Plant_param
pca_plant <- prcomp(Plant_param_normalized[ , -ncol(Plant_param_normalized)], center = TRUE, scale. = FALSE)

# Perform PCA for Soil_param
pca_soil <- prcomp(Soil_param_normalized[ , -ncol(Soil_param_normalized)], center = TRUE, scale. = FALSE)

# Scree plot for Plant_param
scree_plant <- fviz_eig(pca_plant, addlabels = TRUE, 
                        main = "Scree Plot for Plant Parameters", 
                        xlab = "Principal Components", 
                        ylab = "Variance Explained (%)")


# Scree plot for Soil_param
scree_soil <- fviz_eig(pca_soil, addlabels = TRUE, 
                       main = "Scree Plot for Soil Parameters", 
                       xlab = "Principal Components", 
                       ylab = "Variance Explained (%)")






pca_plantdf <- as.data.frame(pca_plant$x)  # Extract PCA scores
pca_plantdf$Group <- plant_soil$Group

# Calculate variance explained by PC1 and PC2
explained_variance <- summary(pca_plant)$importance[2, 1:2] * 100  # Extract variance percentages
pc1_label <- paste0("Principal Component 1 (", round(explained_variance[1], 2), "%)")
pc2_label <- paste0("Principal Component 2 (", round(explained_variance[2], 2), "%)")

# PCA Plot with Smaller Ellipses
pca_plant_scatter <- ggplot(pca_plantdf, aes(x = PC1, y = PC2, color = Group)) +
  geom_point(size = 3, alpha = 0.8) +  # Scatter points
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # Horizontal line at 0
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  # Vertical line at 0
  stat_ellipse(type = "norm", geom = "polygon", alpha = 0.2, aes(fill = Group), 
               level = 0.8, show.legend = FALSE) +  # Adjusted ellipses with smaller confidence level
  labs(title = "PCA of Plant Parameters with Treatment Groups", 
       x = pc1_label, 
       y = pc2_label) +
  theme_minimal() +
  theme(legend.position = "right")


# Calculate percentage contribution for PC1 and PC2
explained_variance <- summary(pca_plant)$importance[2, ] * 100
pc1_label <- paste0("Principal Component 1 (", round(explained_variance[1], 2), "%)")
pc2_label <- paste0("Principal Component 2 (", round(explained_variance[2], 2), "%)")

# Prepare PCA DataFrame for plant_soil
pca_soildf <- as.data.frame(pca_soil$x)  # Extract PCA scores
pca_soildf$Group <- plant_soil$Group

# PCA Plot with Smaller Ellipses for plant_soil
pca_soil_scatter <- ggplot(pca_soildf, aes(x = PC1, y = PC2, color = Group)) +
  geom_point(size = 3, alpha = 0.8) +  # Scatter points
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # Horizontal line at 0
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  # Vertical line at 0
  stat_ellipse(type = "norm", geom = "polygon", alpha = 0.2, aes(fill = Group), 
               level = 0.8, show.legend = FALSE) +  # Adjusted ellipses with smaller confidence level
  labs(title = "PCA of Soil Parameters with Treatment Groups", 
       x = pc1_label, 
       y = pc2_label) +
  theme_minimal() +
  theme(legend.position = "right")



# Loadings for PCA of Plant_param
loadings_plant <- as.data.frame(pca_plant$rotation)

# Calculate percentage contribution for PC1 and PC2
explained_variance_plant <- summary(pca_plant)$importance[2, ] * 100
pc1_label_plant <- paste0("Principal Component 1 (", round(explained_variance_plant[1], 2), "%)")
pc2_label_plant <- paste0("Principal Component 2 (", round(explained_variance_plant[2], 2), "%)")

# Create a dataframe for arrows
arrows_plant <- data.frame(
  x = 0,  # Origin x
  y = 0,  # Origin y
  xend = loadings_plant[, 1],  # PC1 Loadings
  yend = loadings_plant[, 2],  # PC2 Loadings
  Variables = rownames(loadings_plant)  # Variable names
)

# PCA plot with arrows for Plant_param
pca_plant_arrows <- ggplot() +
  geom_segment(data = arrows_plant, aes(x = x, y = y, xend = xend, yend = yend),
               arrow = arrow(length = unit(0.2, "cm")), color = "blue") +
  geom_text(data = arrows_plant, aes(x = xend, y = yend, label = Variables),
            hjust = 1.1, vjust = 1.1, size = 4, color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # Horizontal line at 0
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  # Vertical line at 0
  labs(title = "PCA Plot of Plant Parameters (Loadings Only)",
       x = pc1_label_plant, 
       y = pc2_label_plant) +
  theme_minimal()



# Loadings for PCA of Soil_param
loadings_soil <- as.data.frame(pca_soil$rotation)

# Calculate percentage contribution for PC1 and PC2
explained_variance_soil <- summary(pca_soil)$importance[2, ] * 100
pc1_label_soil <- paste0("Principal Component 1 (", round(explained_variance_soil[1], 2), "%)")
pc2_label_soil <- paste0("Principal Component 2 (", round(explained_variance_soil[2], 2), "%)")

# Create a dataframe for arrows
arrows_soil <- data.frame(
  x = 0,  # Origin x
  y = 0,  # Origin y
  xend = loadings_soil[, 1],  # PC1 Loadings
  yend = loadings_soil[, 2],  # PC2 Loadings
  Variables = rownames(loadings_soil)  # Variable names
)

# PCA plot with arrows for Soil_param
pca_soil_arrows <- ggplot() +
  geom_segment(data = arrows_soil, aes(x = x, y = y, xend = xend, yend = yend),
               arrow = arrow(length = unit(0.2, "cm")), color = "blue") +
  geom_text(data = arrows_soil, aes(x = xend, y = yend, label = Variables),
            hjust = 1.1, vjust = 1.1, size = 4, color = "red") +
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # Horizontal line at 0
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  # Vertical line at 0
  labs(title = "PCA Plot of Soil Parameters (Loadings Only)",
       x = pc1_label_soil, 
       y = pc2_label_soil) +
  theme_minimal()

library(gridExtra)

grid.arrange(
  scree_plant, 
  scree_soil, 
  pca_plant_scatter, 
  pca_soil_scatter, 
  pca_plant_arrows, 
  pca_soil_arrows, 
  ncol = 2  # 3 columns, 2 rows
)


```

<br> <br>



# <u>Comparing PC1 of the Plant parameter analysis to PC1 of the Soil Parameter Analyisis</u>

We then decided to compare PC1 of the Plant parameters and PC1 of the Soil parameters on a scatter plot. Here we can clearly see that the treatment groups are much more clearly separated based on PC1 of plant parameters than based on PC1 of soil parameters. This is probably due because PC1 of Plant parameters much more clearly groups the treatments just on its own it accounts for 73.2% of variance, while PC1 of the Soil Parameters only explains 42.9%. So we can see that the treatments have a much more noticable impact on plant parameters.

```{r, error=FALSE, echo=TRUE}
# Combine PCA data for plotting
pca_combined <- data.frame(
  Plant_PC1 = pca_plant$x[, 1],  # PC1 of Plant parameters
  Soil_PC1 = pca_soil$x[, 1],    # PC1 of Soil parameters
  Group = plant_soil$Group       # Group information (from the dataset)
)

pca_scatter <- ggplot(pca_combined, aes(x = Plant_PC1, y = Soil_PC1, color = Group)) +
  geom_point(size = 3, alpha = 0.8) +  # Scatter points
  geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +  # Horizontal line at 0
  geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +  # Vertical line at 0
  stat_ellipse(type = "norm", geom = "polygon", alpha = 0.2, 
               aes(fill = Group), level = 0.8, show.legend = FALSE) +  # Same fill as dots
  labs(title = "PCA Scatter Plot: PC1 of Plant vs PC1 of Soil",
       x = "Plant PC1",
       y = "Soil PC1") +
  theme_minimal() +
  theme(legend.position = "right",
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 12, face = "bold")) +
  scale_color_brewer(palette = "Set2") +  # Adjust color palette if needed
  scale_fill_brewer(palette = "Set2")  # Ensure the fill of the ellipse matches the color of the dots
print(pca_scatter)

```


<br> <br> 

# <u>Linear Discriminant Analysis of all parameters</u>

We decide to do a Linear discriminant analysis on our measured variables in order to visualize and understand which variables separate the groups the most. So we could use this to see which variables had the most group specific variation, and from this we can see which variables had the strongest correlation with treatments. 

First we decided to do an LDA with all of the variables included. Based on this R could produce an equation that very clearly separated the treatment groups. So we summarized that there were multiple parameters that showed a large correlation with groups. We will talk about these parameters in the separated LDA section because there it is clearer. However from this LDA with all the variables it is clear that there were variables were very differentiating according to treatments. 

It is worth mentioning that the LDA with all the variables produced a very similar plot compared to the LDA with only the Plant parameters. From this we can summarize that the parameters that were the best at differentiating between groups are in the plant parameters subgroup. 

We also included the equations generated by R, to better showcase and explain which variables separated the treatment groups best. 

```{r, echo=TRUE, error=FALSE, warning=FALSE, message=FALSE}
perform_lda <- function(data, group_col, threshold = 0.1, plot_title_prefix = "") {
  # Standardize the data
  data_std <- data
  predictors <- setdiff(names(data), group_col)
  data_std[, predictors] <- scale(data[, predictors])
  data_std[[group_col]] <- as.factor(data_std[[group_col]])
  
  # Perform LDA
  lda_model <- lda(as.formula(paste(group_col, "~ .")), data = data_std)
  
  # Extract the LDA equations
  coefficients <- coef(lda_model)
  ld1_equation <- paste(
    "LD1 =",
    paste0(
      round(coefficients[, 1], 3), 
      "*", rownames(coefficients),
      collapse = " + "
    )
  )
  ld2_equation <- paste(
    "LD2 =",
    paste0(
      round(coefficients[, 2], 3), 
      "*", rownames(coefficients),
      collapse = " + "
    )
  )
  
  # Predictions and LDA scores
  predictions <- predict(lda_model)
  data_std$LD1 <- predictions$x[, 1]
  data_std$LD2 <- predictions$x[, 2]
  
  # Plot LDA results
  lda_plot <- ggplot(data_std, aes(x = LD1, y = LD2, color = !!sym(group_col), fill = !!sym(group_col))) +
    geom_point(size = 3) +
    stat_ellipse(geom = "polygon", alpha = 0.3) +
    labs(title = paste(plot_title_prefix, "LDA Plot"), x = "LD1", y = "LD2") +
    theme_minimal() +
    theme(legend.title = element_blank())
  
  print(lda_plot)  # Print the LDA plot
  
  # Print the equations below the plot
  cat("\nEquation for LD1:\n", ld1_equation, "\n\n")
  cat("Equation for LD2:\n", ld2_equation, "\n\n")
  
  # Variable importance
  coefficients_df <- data.frame(
    Variable = rownames(coefficients),
    LD1 = coefficients[, 1],
    LD2 = coefficients[, 2],
    Importance = rowSums(abs(coefficients))
  )
  
  # Filter for arrows
  coefficients_filtered <- subset(coefficients_df, Importance > threshold)
  
  # Arrow plot
  arrow_plot <- ggplot(coefficients_filtered, aes(x = 0, y = 0)) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
    geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +
    geom_segment(aes(xend = LD1, yend = LD2), 
                 arrow = arrow(type = "closed", length = unit(0.1, "inches")), 
                 linewidth = 1) +
    geom_text(aes(x = LD1, y = LD2, label = Variable), color = "red", size = 3, hjust = 1.5, vjust = 1.5) +
    labs(title = paste(plot_title_prefix, "LDA contribution of variables"), x = "LD1", y = "LD2") +
    theme_minimal() +
    theme(axis.text = element_text(color = "black"), 
          axis.title = element_text(size = 12),       
          axis.ticks = element_line(color = "black"))
  
  print(arrow_plot)  # Print arrow plot to the R graphics device
  
  return(list(lda_model = lda_model, predictions = predictions, lda_plot = lda_plot, arrow_plot = arrow_plot))
}


big_LDA <- perform_lda(plant_soil, "Group", threshold = 0.1, plot_title_prefix = "All variables measured")


```

<br> <br> 

# <u>Linear Discriminant Analysis of Plant Parameters and Soil Parameters separately</u>

We then decided to conduct LDA with the variable groupings that we used for the PCA analysis. As seen in the PCA of Plant parameters were much better at separating between groups than soil parameters. 

We can see that it is easy to separate the treatment groups based on plant parameters, but it is not a very clear separation based on soil parameters. Which means that plant parameters were more noticably different after treatments than soil parameters. 

For the plant parameters according to the equation for the LDA plot the most important variables for LD1 were: Aboveground_Biomass, Belowground_Biomass, Total_Biomass.
And for LD2 were: Aboveground_Biomass, Belowground_Biomass, Total_Biomass, RootLength, RootSurfaceArea.
These variables are all clearly correlated with each other as well so the most important factor differentiating between tretments is the size of the plants. 


For the soil parameters according to the equation for the LDA plot the most important variable for LD1 were: Total_P, PH, EC, UE. 
And for LD2 were: EC, PH and Total_N. 
As the groupings are not as clear here, as in the LDA for plant parameters we can not really draw a lot of conclusions from this analysis. However some similar variables appear to be important in the LDA analysis as the PCA. Like Plant_P, soil Urease, and EC. Which means that these variables, are not only highly varied between each measurement as well as they are great at separating groups, so the variation is highly correlated with treatments.  
```{r, error=FALSE, echo=TRUE, message=FALSE, warning=FALSE}

perform_lda <- function(data, group_col, threshold = 0.1, plot_title_prefix = "") {
  # Standardize the data
  data_std <- data
  predictors <- setdiff(names(data), group_col)
  data_std[, predictors] <- scale(data[, predictors])
  data_std[[group_col]] <- as.factor(data_std[[group_col]])
  
  # Perform LDA
  lda_model <- lda(as.formula(paste(group_col, "~ .")), data = data_std)
  
  # Extract the LDA equations
  coefficients <- coef(lda_model)
  ld1_equation <- paste(
    "LD1 =",
    paste0(
      round(coefficients[, 1], 3), 
      "*", rownames(coefficients),
      collapse = " + "
    )
  )
  ld2_equation <- paste(
    "LD2 =",
    paste0(
      round(coefficients[, 2], 3), 
      "*", rownames(coefficients),
      collapse = " + "
    )
  )
  
  # Predictions and LDA scores
  predictions <- predict(lda_model)
  data_std$LD1 <- predictions$x[, 1]
  data_std$LD2 <- predictions$x[, 2]
  
  # Plot LDA results
  lda_plot <- ggplot(data_std, aes(x = LD1, y = LD2, color = !!sym(group_col), fill = !!sym(group_col))) +
    geom_point(size = 3) +
    stat_ellipse(geom = "polygon", alpha = 0.3) +
    labs(title = paste(plot_title_prefix, "LDA Plot"), x = "LD1", y = "LD2") +
    theme_minimal() +
    theme(legend.title = element_blank())
  
  print(lda_plot)  # Print the LDA plot
  
  # Print the equations below the plot
  cat("\nEquation for LD1:\n", ld1_equation, "\n\n")
  cat("Equation for LD2:\n", ld2_equation, "\n\n")
  
  # Variable importance
  coefficients_df <- data.frame(
    Variable = rownames(coefficients),
    LD1 = coefficients[, 1],
    LD2 = coefficients[, 2],
    Importance = rowSums(abs(coefficients))
  )
  
  # Filter for arrows
  coefficients_filtered <- subset(coefficients_df, Importance > threshold)
  
  # Arrow plot
  arrow_plot <- ggplot(coefficients_filtered, aes(x = 0, y = 0)) +
    geom_hline(yintercept = 0, linetype = "dashed", color = "gray") +
    geom_vline(xintercept = 0, linetype = "dashed", color = "gray") +
    geom_segment(aes(xend = LD1, yend = LD2), 
                 arrow = arrow(type = "closed", length = unit(0.1, "inches")), 
                 linewidth = 1) +
    geom_text(aes(x = LD1, y = LD2, label = Variable), color = "red", size = 3, hjust = 1.5, vjust = 1.5) +
    labs(title = paste(plot_title_prefix, "LDA contribution of variables"), x = "LD1", y = "LD2") +
    theme_minimal() +
    theme(axis.text = element_text(color = "black"), 
          axis.title = element_text(size = 12),       
          axis.ticks = element_line(color = "black"))
  
  print(arrow_plot)  # Print arrow plot to the R graphics device
  
  return(list(lda_model = lda_model, predictions = predictions, lda_plot = lda_plot, arrow_plot = arrow_plot))
}


# Perform LDA for Plant Parameters
plant_lda_results <- perform_lda(Plant_param, "Group", threshold = 0.1, plot_title_prefix = "Plant Parameters")

# Perform LDA for Soil Parameters
soil_lda_results <- perform_lda(Soil_param, "Group", threshold = 0.1, plot_title_prefix = "Soil Parameters")


```

<br> 

# <u>Correlogram of all variables</u>

We thought it would be a good idea to showcase the correlations between all variables in a correlogram. In this format it is easy to see that some variables share some correlation if we don't consider groups as well. We then took the strongest correlations and some of the interesting ones and plotted them as linerar regressions below. 
```{r, error=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
# Load necessary libraries
if (!require(ggplot2)) install.packages("ggplot2")
library(ggplot2)

# Example: Assuming Plant_param and Soil_param data are already loaded
# Calculate correlation matrix
correlation_matrix <- cor(Plant_param[, -1], Soil_param[, -1], use = "pairwise.complete.obs")

# Convert the correlation matrix to a long format
correlation_data <- as.data.frame(as.table(correlation_matrix))
colnames(correlation_data) <- c("Plant_Parameter", "Soil_Parameter", "Correlation")

# Create the correlogram plot with circles
correlogram <- ggplot(correlation_data, aes(x = Plant_Parameter, y = Soil_Parameter)) +
  geom_point(aes(size = abs(Correlation), color = Correlation)) +
  scale_color_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0, 
                        name = "Correlation") +
  scale_size_continuous(range = c(2, 10), name = "Strength\nof Correlation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
        axis.text = element_text(size = 10),
        axis.title = element_text(size = 12, face = "bold")) +
  labs(title = "Correlogram: Plant vs. Soil Parameters",
       x = "Plant Parameters",
       y = "Soil Parameters")
print(correlogram)

```


<br><br>

# <u>Correlogramms showing the correlation Specific Root Length (SRL) has with plant and soil parameters separately</u>

The original authors of the paper thought it would be important to showcase specific root length (SRL) correlation with other variables, as they thought that the synergy of AMF and PGPB affected SRL the most compared to other treatments, and that SRL explains the Plant Phosphorus, and Plant biomass differences, as they thought that an increase in SRL would improve plant nutrient uptake. We thought these correlograms would be a better visualization of these correlations. 
There is in fact a strong positive correlation between SRL and Plant P, but surprisingly there is a strong negative correlation between Belowground biomass and SRL. A somewhat not surprising result is that SRL is not strongly correlated with any of the soil parameters. Except for Urease with which it is surprisingly correlated but not in a linear way, we showcase this nonlinear correlation below. 
```{r, error=FALSE, warning=FALSE, echo=TRUE, message=FALSE}
# Load required libraries

if (!require(ggplot2)) install.packages("ggplot2")
if (!require(reshape2)) install.packages("reshape2")
library(ggplot2)
library(reshape2)

# Extract SRL (Specific Root Length)
SRL <- Plant_param$SRL

# Exclude SRL column and retain only numeric columns from Plant parameters
Plant_param_no_srl <- Plant_param[, !names(Plant_param) %in% "SRL"]
Plant_param_no_srl <- Plant_param_no_srl[sapply(Plant_param_no_srl, is.numeric)]  # Retain only numeric columns

# Exclude SRL column and retain only numeric columns from Soil parameters
Soil_param_numeric <- Soil_param[sapply(Soil_param, is.numeric)]  # Retain only numeric columns

# Prepare data for correlogram: SRL vs Plant parameters
plant_corr <- sapply(Plant_param_no_srl, function(x) cor(SRL, x, use = "complete.obs"))
plant_corr_df <- data.frame(Variable = names(plant_corr), Correlation = plant_corr)
plant_corr_df <- plant_corr_df[order(plant_corr_df$Correlation, decreasing = TRUE), ]

# Prepare data for correlogram: SRL vs Soil parameters
soil_corr <- sapply(Soil_param_numeric, function(x) cor(SRL, x, use = "complete.obs"))
soil_corr_df <- data.frame(Variable = names(soil_corr), Correlation = soil_corr)
soil_corr_df <- soil_corr_df[order(soil_corr_df$Correlation, decreasing = TRUE), ]

# Plot 1: SRL vs Plant parameters
plot1 <- ggplot(plant_corr_df, aes(x = Variable, y = "SRL", fill = Correlation, size = abs(Correlation))) +
  geom_point(shape = 21, color = "black") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0, limits = c(-1, 1)) +
  scale_size_continuous(range = c(3, 8)) +
  labs(title = "Correlation: SRL vs Plant Parameters",
       x = "Plant Parameters", y = NULL, fill = "Correlation", size = "Strength") +
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.title.x = element_text(size = 10, margin = margin(t = 5)),
    plot.margin = margin(5, 5, 5, 5)
  )
print(plot1)
# Plot 2: SRL vs Soil parameters
plot2 <- ggplot(soil_corr_df, aes(x = Variable, y = "SRL", fill = Correlation, size = abs(Correlation))) +
  geom_point(shape = 21, color = "black") +
  scale_fill_gradient2(low = "blue", mid = "white", high = "red", midpoint = 0, limits = c(-1, 1)) +
  scale_size_continuous(range = c(3, 8)) +
  labs(title = "Correlation: SRL vs Soil Parameters",
       x = "Soil Parameters", y = NULL, fill = "Correlation", size = "Strength") +
  theme_minimal(base_size = 10) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1, vjust = 1),
    axis.title.x = element_text(size = 10, margin = margin(t = 5)),
    plot.margin = margin(5, 5, 5, 5)
  )
print(plot2)


```


<br> <br> <br>

# <u>Some notable correlations</u> 

We thougt it would be important to show these correlations on graphs as well. They are not strong however they could be considered for further analysis and study, as the study of the original paper doesn't have a high sample number these correlations could be strengthened or dismissed with a study containing more samples. 
```{r, error=FALSE, echo=TRUE, message=FALSE, warning=FALSE, fig.width=12, fig.height=24 }

# Load required libraries
library(ggplot2)
library(gridExtra)

# Third plot: Correlation between Plant_P and SRL
subset_data <- plant_soil[, c("Plant_P", "SRL", "Group")]
model <- lm(SRL ~ Plant_P, data = subset_data)
r_squared <- summary(model)$r.squared

p3 <- ggplot(subset_data, aes(x = Plant_P, y = SRL, color = Group)) +
  geom_point(alpha = 0.6, size = 2) + 
  geom_smooth(method = "lm", color = "red", se = FALSE) + 
  annotate("text", x = min(subset_data$Plant_P, na.rm = TRUE), 
           y = max(subset_data$SRL, na.rm = TRUE), 
           label = paste("R^2 =", round(r_squared, 3)),
           hjust = 0, vjust = 1, size = 5, color = "black") + 
  labs(title = "Correlation between Plant_P and SRL",
       x = "Plant P", y = "SRL") + 
  theme_minimal()

# Sixth plot: Correlation between Total Biomass and Plant P (for Group A2 & AB5)
subset_data <- plant_soil[plant_soil$Group %in% c("A2", "AB5"), c("Total_Biomass", "Plant_P", "Group")]
model <- lm(Plant_P ~ Total_Biomass, data = subset_data)
r_squared <- summary(model)$r.squared

p6 <- ggplot(subset_data, aes(x = Total_Biomass, y = Plant_P, color = Group)) +
  geom_point(alpha = 0.6, size = 2) + 
  geom_smooth(method = "lm", color = "red", se = FALSE) + 
  annotate("text", x = min(subset_data$Total_Biomass, na.rm = TRUE), 
           y = max(subset_data$Plant_P, na.rm = TRUE), 
           label = paste("R^2 =", round(r_squared, 3)),
           hjust = 0, vjust = 1, size = 5, color = "black") + 
  labs(title = "Correlation between Total Biomass and Plant P (A2 & AB5)",
       x = "Total Biomass", y = "Plant P") + 
  theme_minimal()

# Eighth plot: Correlation between Root Branches and Plant P
subset_data <- plant_soil[, c("Rootbranches", "Plant_P", "Group")]
model <- lm(Plant_P ~ Rootbranches, data = subset_data)
r_squared <- summary(model)$r.squared

p8 <- ggplot(subset_data, aes(x = Rootbranches, y = Plant_P, color = Group)) +
  geom_point(alpha = 0.6, size = 2) + 
  geom_smooth(method = "lm", color = "red", se = FALSE) + 
  annotate("text", x = min(subset_data$Rootbranches, na.rm = TRUE), 
           y = max(subset_data$Plant_P, na.rm = TRUE), 
           label = paste("R^2 =", round(r_squared, 3)),
           hjust = 0, vjust = 1, size = 5, color = "black") + 
  labs(title = "Correlation between Root Branches and Plant P",
       x = "Root Branches", y = "Plant P") + 
  theme_minimal()

# Arrange plots 3, 6, and 8 in a single column
grid.arrange(p3, p6, p8, ncol = 1)


```


<br> <br> 

# <u>Urease and Plant Phosphorus non-linear relation</u>

Looking at the dot plot of this correlation we realized that these variables are very strongly correlated in a negative non linear manner, so we used r to fit an exponential model on the dot plot. This correlation definitely requires further investigation as it is quite clear and very strong. However it is also unexpected as Urease is an enzyme that is used in plant-nitrogen interactions and it is correlated with plant phosphorus. We would like to mention that this correlation could be because Urease activity is inhibited by phosphate. But this is just guessing and this correlation requires further investigation. 
```{r, error=FALSE, echo=TRUE, message=FALSE, warning=FALSE}
# Load required libraries
library(ggplot2)

# Example dataset
set.seed(123)
df_numeric <- data.frame(
  Plant_P = seq(0, 10, length.out = 100),
  UE = 400 * exp(-0.5 * seq(0, 10, length.out = 100)) + rnorm(100, 0, 10)
)

# Fit an exponential decay model: UE = a * exp(b * Plant_P)
exp_model <- nls(UE ~ a * exp(b * Plant_P), data = df_numeric, start = list(a = 400, b = -0.5))

# Extract model coefficients
coeffs <- coef(exp_model)
a <- round(coeffs["a"], 2)
b <- round(coeffs["b"], 4)

# Predict values for the curve
df_numeric$Predicted_UE <- predict(exp_model)

# Calculate pseudo-R²
RSS <- sum((df_numeric$UE - df_numeric$Predicted_UE)^2) # Residual sum of squares
TSS <- sum((df_numeric$UE - mean(df_numeric$UE))^2)     # Total sum of squares
pseudo_R2 <- 1 - (RSS / TSS)                            # Pseudo-R²

# Construct the formula string to display
formula_text <- paste0("UE = ", a, " * exp(", b, " * Plant_P)")
pseudoR2_text <- paste0("Pseudo-R² = ", round(pseudo_R2, 3))

# Plot the data with the exponential curve, formula, and pseudo-R²
ggplot(df_numeric, aes(x = Plant_P, y = UE)) +
  geom_point(color = "blue", alpha = 0.6, size = 2) +
  geom_line(aes(y = Predicted_UE), color = "red", size = 1) +
  # Adjust x to move annotations further left
  annotate("text", x = max(df_numeric$Plant_P) * 0.4, y = max(df_numeric$UE) * 0.9,
           label = formula_text, size = 5, color = "black", hjust = 0) +
  annotate("text", x = max(df_numeric$Plant_P) * 0.6, y = max(df_numeric$UE) * 0.8,
           label = pseudoR2_text, size = 5, color = "black", hjust = 0) +
  labs(title = "Exponential Model: UE vs Plant_P",
       x = "Plant_P", y = "UE") +
  theme_minimal()

```

<br> <br> 

## 7. Discussion. 

Our ANOVA results demonstrate that AMF had a stronger and more consistent impact on plant
growth and soil properties compared to PGPB alone. AMF treatments significantly improved total
biomass, nitrate availability, and phosphorus uptake, highlighting their ability to enhance plant
nutrient and water absorption. The combined AMF + PGPB treatment showed some additional
benefits, such as increased urease activity and electrical conductivity, but these improvements were
not consistent, suggesting that AMF drives most of the observed effects.

The PCA analysis revealed that plant parameters are much better at separating treatment groups
than soil parameters. Plant PC1 explained 73.2% of the variance, with key contributors being traits
like biomass and root length. This shows that treatments had a strong impact on plant traits, making
them more responsive indicators of treatment effects. Soil PC1, explaining 42.9% of the variance, was
less effective at differentiating groups, as soil parameters showed slight variations across treatments.

The LDA analysis supported these findings, with plant parameters providing clearer separation
between groups, driven by variables like total biomass and root surface area. In contrast, soil
parameters showed less distinct group separation, with variables like pH and urease activity
contributing the most. Morevoer, some variables, such as soil urease and EC, were consistently
important in both PCA and LDA, indicating their strong correlation with treatments.

The correlogram of all variables revealed important relationships between plant and soil parameters,
helping to identify key drivers of treatment effects. Strong positive correlations were observed
between biomass traits and soil parameters like nitrate and electrical conductivity, indicating that
better soil conditions directly promote plant growth. Interestingly, root traits such as the root-to-
shoot ratio (R/S) showed weaker or negative correlations with biomass, reflecting trade-offs in plant
resource allocation. Specific Root Length (SRL) also emerged as an important plant trait, showing a
strong positive correlation with Plant P, emphasizing its role in improving nutrient uptake efficiency.

The specific root length (SRL) correlograms highlighted SRL’s importance further. SRL was positively
correlated with Plant P, confirming its role in enhancing phosphorus uptake, but it showed a negative
correlation with belowground biomass, meaning that plants with higher SRL might use less energy to
grow bigger roots. Additionally, this correlogram revealed a nonlinear exponential relationship
between urease activity and Plant P. As phosphorus levels increased, urease activity decreased,
which might suggest an inhibitory effect of phosphate on urease. This unexpected link between
nitrogen and phosphorus shows how nutrient cycling can be more complex due to the treatments.

### 8. Conclusions.

Through statistical and multivariate analyses, this project supported the hypothesis that the combined application of AMF and PGPR enhances plant growth and soil quality more effectively than individual treatments:

Significant variations observed in plant traits and soil parameters confirmed that AMF and PGPR, when applied together, exhibit synergistic effects.

PCA and LDA analyses highlighted relationships between plant performance and soil quality, identifying key drivers such as phosphorus uptake, urease activity, and specific root length (SRL).

Correlations between variables, including nonlinear trends, underscored the complexity of interactions in plant-soil systems and focus attention on the need for multivariate approaches to understand these dynamics fully.

.........................................


